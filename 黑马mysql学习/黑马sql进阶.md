### MySql体系结构

<img src="images/image-20220920160136489.png">

#### 连接层

最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关的安全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。

#### 服务层

第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现， 如过程、函数等。
#### 引擎层
存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。
#### 存储层
主要是将数据存储在文件系统之上，并完成与存储引擎的交互。

### 存储引擎

> 存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。

```sql
SHOW create table account;#查询该表的存储引擎

SHOW ENGINES;#查询当前数据库支持的存储引擎

CREATE TABLE my_myisam(
	id int,
	name VARCHAR(10)
)ENGINE = INNODB;#默认InnoDB
```

#### InnoDB

> InnoDB是一种兼顾 高可靠性和高性能的通用存储引擎，在MySQL 5.5之后，InnoDB是默认的MySQL存储引擎。

##### 特点

1. DML操作遵循ACID模型，支持事务;

2. 行级锁，提高并发访问性能;

3. 支持外键FOREIGN KEY约束，保证数据的完整性和正确性;

##### 文件

XXX.ibd: xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件， 存储该表的表结构(frm、 sdi) 、数据和索引。

参数: innodb_file_per_table#开启后一个表对应一个表空间，否则共享表空间

```sql
SHOW VARIABLES LIKE 'innodb_file_per_table';#NO
#我的Mysql版本 5.7.36
```

##### 逻辑存储结构

<img src="images/image-20220920180633379.png">

#### Myisam

> MyISAM是MySql早期的默认存储引擎

##### 特点

不支持事务，不支持外键

支持表锁，不支持行锁

访问速度快

##### 文件

xxx.sdi: 存储表结构信息

xxx.MYD: 存储数据

xxx.MYI: 存储索引

#### Memory

> Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。

##### 特点

内存存放

hash索引( 默认)

##### 文件

xxx.sdi:存储表结构信息

<img src="images/image-20220920181712368.png">

#### 存储引擎选择

> 在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。

**InnoDB:** 是Mysq|的默认存储引擎，**支持事务、外键**。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。

**MyISAM:** 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。（日志，评论）

**MEMORY:** 将所有数据保存在内存中，**访问速度快，通常用于临时表及缓存**。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。

### 索引

>索引(index) 是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用(指向)数据，这样就可以在这些数据结构上实现高级查找算法,这种数据结构就是索引。
